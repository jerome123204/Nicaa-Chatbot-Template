/**
 * DO NOT EDIT THIS FILE DIRECTLY.
 * This file is generated following the conversion of 
 * @see [./node_modules/websocket-stream/server.js]{@link ./node_modules/websocket-stream/server.js}
 * 
 **/
import _toesmTemp11  from "../ws/index.mjs";
import stream  from "./stream.mjs";
'use strict'


var WebSocketServer  = _toesmTemp11.Server


export class Server  extends WebSocketServer{
  constructor(opts, cb) {
    super(opts)

    var proxied = false
    this.on('newListener', function(event) {
      if (!proxied && event === 'stream') {
        proxied = true
        this.on('connection', function(conn, req) {
          this.emit('stream', stream(conn, opts), req)
        })
      }
    })

    if (cb) {
      this.on('stream', cb)
    }
  }
}

export const createServer = function(opts, cb) {
  return new Server(opts, cb)
}
